# üìò –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ API
# Firebird Database Proxy API - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 6 –Ω–æ—è–±—Ä—è 2025  
**URL API:** `http://85.114.224.45:8000`

---

## üéØ –ß–¢–û –≠–¢–û –¢–ê–ö–û–ï

–≠—Ç–æ REST API –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Firebird. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã (—Ç–æ–ª—å–∫–æ SELECT) –∏ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å—ã.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SELECT –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –∑–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–∞–º–∏)
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã)

---

## üîë –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ health check) —Ç—Ä–µ–±—É—é—Ç Bearer Token –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**–§–æ—Ä–º–∞—Ç:**
```
Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù_64_–°–ò–ú–í–û–õ–ê
```

**–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:**
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –¢–æ–∫–µ–Ω –≤—ã–¥–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

---

## üì° ENDPOINTS

### 1. Health Check (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞)

**GET** `/api/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://85.114.224.45:8000/api/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "database_connected": true,
  "uptime_seconds": 12345.67,
  "version": "1.0.0",
  "timestamp": "2025-11-06T12:00:00"
}
```

---

### 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–∞

**POST** `/api/query`

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SELECT –∏–ª–∏ WITH –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –¢–æ–ª—å–∫–æ SELECT –∏ WITH –∑–∞–ø—Ä–æ—Å—ã
- ‚ùå UPDATE, DELETE, INSERT, DROP, ALTER –∑–∞–ø—Ä–µ—â–µ–Ω—ã
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "query": "SELECT * FROM TABLE_NAME WHERE ID = ?",
  "params": [123]
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - SQL –∑–∞–ø—Ä–æ—Å (—Å—Ç—Ä–æ–∫–∞)
- `params` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (–º–∞—Å—Å–∏–≤)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://85.114.224.45:8000/api/query \
  -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "SELECT FIRST 10 * FROM STORGRP ORDER BY NAME"
  }'
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):**
```json
{
  "success": true,
  "data": [
    {"ID": 1, "NAME": "–ì—Ä—É–ø–ø–∞ 1"},
    {"ID": 2, "NAME": "–ì—Ä—É–ø–ø–∞ 2"}
  ],
  "rows_count": 2,
  "execution_time": 0.005,
  "error": null,
  "timestamp": "2025-11-06T12:00:00"
}
```

**–û—à–∏–±–∫–∞ (400) - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π SQL:**
```json
{
  "success": false,
  "data": null,
  "rows_count": null,
  "execution_time": null,
  "error": "SQL validation failed: Forbidden operation detected: UPDATE",
  "timestamp": "2025-11-06T12:00:00"
}
```

**–û—à–∏–±–∫–∞ (401) - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω:**
```json
{
  "detail": "Invalid authentication credentials"
}
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü

**GET** `/api/tables`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://85.114.224.45:8000/api/tables \
  -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù"
```

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "success": true,
  "tables": ["STORGRP", "STORZAKAZDT", "GOODS", ...],
  "count": 362,
  "timestamp": "2025-11-06T12:00:00"
}
```

---

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã

**GET** `/api/schema/{table_name}`

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–æ–Ω–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø, nullable).

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://85.114.224.45:8000/api/schema/STORGRP \
  -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù"
```

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "success": true,
  "table": "STORGRP",
  "columns": [
    {"name": "ID", "type": "INTEGER", "nullable": false},
    {"name": "NAME", "type": "VARCHAR(100)", "nullable": true}
  ],
  "timestamp": "2025-11-06T12:00:00"
}
```

---

## üíª –ü–†–ò–ú–ï–†–´ –ö–û–î–ê

### Python

```python
import requests

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
API_URL = "http://85.114.224.45:8000"
TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨"

headers = {
    "Authorization": f"Bearer {TOKEN}",
    "Content-Type": "application/json"
}

# –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π SELECT –∑–∞–ø—Ä–æ—Å
def get_data(query):
    response = requests.post(
        f"{API_URL}/api/query",
        json={"query": query},
        headers=headers
    )
    
    if response.status_code == 200:
        data = response.json()
        if data["success"]:
            return data["data"]
        else:
            print(f"–û—à–∏–±–∫–∞: {data['error']}")
            return None
    else:
        print(f"HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
        return None

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
result = get_data("SELECT FIRST 10 * FROM STORGRP ORDER BY NAME")
if result:
    for row in result:
        print(row)

# –ü—Ä–∏–º–µ—Ä 2: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
def get_by_id(table, id_value):
    query = f"SELECT * FROM {table} WHERE ID = ?"
    response = requests.post(
        f"{API_URL}/api/query",
        json={"query": query, "params": [id_value]},
        headers=headers
    )
    
    if response.status_code == 200:
        data = response.json()
        if data["success"] and data["data"]:
            return data["data"][0]  # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞
    return None

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
item = get_by_id("STORGRP", 123)
if item:
    print(f"–ù–∞–π–¥–µ–Ω–æ: {item}")

# –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü
def get_tables():
    response = requests.get(
        f"{API_URL}/api/tables",
        headers=headers
    )
    
    if response.status_code == 200:
        data = response.json()
        return data["tables"]
    return []

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
tables = get_tables()
print(f"–î–æ—Å—Ç—É–ø–Ω–æ —Ç–∞–±–ª–∏—Ü: {len(tables)}")
```

---

## üß© –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python)

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `Granit DB analize sales` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä `ProxyApiConnector` –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–∞ "–£–¥–∞–ª–µ–Ω–Ω–∞—è –ë–î (—á–µ—Ä–µ–∑ API)" –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

### –§–∞–π–ª—ã
- `src/proxy_api_connector.py` ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–ª–∞—Å—Å –¥–ª—è REST API (health check, SELECT-–∑–∞–ø—Ä–æ—Å—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂).
- `src/gui_app.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π GUI —Å —Ç—Ä–µ—Ç—å–∏–º —Ä–µ–∂–∏–º–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
- `config/proxy_api.env.example` ‚Äî —à–∞–±–ª–æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ API. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ `config/proxy_api.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`PROXY_API_URL`, `PROXY_API_TOKEN`, `PROXY_API_FALLBACK_TOKEN`).
- `scripts/test_proxy_connection.py` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API (health check, —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã).

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
```bash
python scripts/test_proxy_connection.py
```

–°–∫—Ä–∏–ø—Ç:
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `config/proxy_api.env`.
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç health check.
3. –î–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (`STORGRP`, –≤—ã–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∂).
4. –ú–∞—Å–∫–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ –≤—ã–≤–æ–¥–µ.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ GUI
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` (—Å–º. –≤—ã—à–µ).
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ GUI (`python run_gui.py`).
3. –í —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" –≤—ã–±–µ—Ä–∏—Ç–µ **"–£–¥–∞–ª–µ–Ω–Ω–∞—è –ë–î (—á–µ—Ä–µ–∑ API)"**.
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ URL/—Ç–æ–∫–µ–Ω—ã –ø—Ä—è–º–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (–∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ `.env`).
5. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è health check API –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î.
6. –î–∞–ª–µ–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã –∫–∞–∫ –≤ –æ–±—ã—á–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö (–¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è).

–í—Å–µ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git (—Å–º. `.gitignore`).

---

### JavaScript/TypeScript (Node.js)

```javascript
const axios = require('axios');

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏
const API_URL = 'http://85.114.224.45:8000';
const TOKEN = '–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨';

const headers = {
  'Authorization': `Bearer ${TOKEN}`,
  'Content-Type': 'application/json'
};

// –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π SELECT –∑–∞–ø—Ä–æ—Å
async function getData(query) {
  try {
    const response = await axios.post(
      `${API_URL}/api/query`,
      { query },
      { headers }
    );
    
    if (response.data.success) {
      return response.data.data;
    } else {
      console.error('–û—à–∏–±–∫–∞:', response.data.error);
      return null;
    }
  } catch (error) {
    console.error('HTTP –æ—à–∏–±–∫–∞:', error.response?.status, error.message);
    return null;
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
(async () => {
  const result = await getData('SELECT FIRST 10 * FROM STORGRP ORDER BY NAME');
  if (result) {
    result.forEach(row => console.log(row));
  }
})();

// –ü—Ä–∏–º–µ—Ä 2: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
async function getById(table, id) {
  try {
    const response = await axios.post(
      `${API_URL}/api/query`,
      {
        query: `SELECT * FROM ${table} WHERE ID = ?`,
        params: [id]
      },
      { headers }
    );
    
    if (response.data.success && response.data.data.length > 0) {
      return response.data.data[0];
    }
    return null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
    return null;
  }
}

// –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü
async function getTables() {
  try {
    const response = await axios.get(
      `${API_URL}/api/tables`,
      { headers }
    );
    return response.data.tables || [];
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
    return [];
  }
}
```

---

### C# (.NET)

```csharp
using System;
using System.Net.Http;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;

public class FirebirdApiClient
{
    private readonly string _apiUrl = "http://85.114.224.45:8000";
    private readonly string _token = "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨";
    private readonly HttpClient _httpClient;

    public FirebirdApiClient()
    {
        _httpClient = new HttpClient();
        _httpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {_token}");
    }

    // –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π SELECT –∑–∞–ø—Ä–æ—Å
    public async Task<List<Dictionary<string, object>>> ExecuteQuery(string query)
    {
        var requestBody = new
        {
            query = query
        };

        var json = JsonSerializer.Serialize(requestBody);
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        var response = await _httpClient.PostAsync($"{_apiUrl}/api/query", content);
        var responseContent = await response.Content.ReadAsStringAsync();

        if (response.IsSuccessStatusCode)
        {
            var result = JsonSerializer.Deserialize<QueryResponse>(responseContent);
            if (result.Success)
            {
                return result.Data;
            }
            else
            {
                Console.WriteLine($"–û—à–∏–±–∫–∞: {result.Error}");
                return null;
            }
        }
        else
        {
            Console.WriteLine($"HTTP –æ—à–∏–±–∫–∞: {response.StatusCode}");
            return null;
        }
    }

    // –ü—Ä–∏–º–µ—Ä 2: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    public async Task<Dictionary<string, object>> GetById(string table, int id)
    {
        var requestBody = new
        {
            query = $"SELECT * FROM {table} WHERE ID = ?",
            @params = new[] { id }
        };

        var json = JsonSerializer.Serialize(requestBody);
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        var response = await _httpClient.PostAsync($"{_apiUrl}/api/query", content);
        var responseContent = await response.Content.ReadAsStringAsync();

        if (response.IsSuccessStatusCode)
        {
            var result = JsonSerializer.Deserialize<QueryResponse>(responseContent);
            if (result.Success && result.Data.Count > 0)
            {
                return result.Data[0];
            }
        }
        return null;
    }

    // –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü
    public async Task<List<string>> GetTables()
    {
        var response = await _httpClient.GetAsync($"{_apiUrl}/api/tables");
        var responseContent = await response.Content.ReadAsStringAsync();

        if (response.IsSuccessStatusCode)
        {
            var result = JsonSerializer.Deserialize<TablesResponse>(responseContent);
            return result.Tables;
        }
        return new List<string>();
    }
}

// –ö–ª–∞—Å—Å—ã –¥–ª—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
public class QueryResponse
{
    public bool Success { get; set; }
    public List<Dictionary<string, object>> Data { get; set; }
    public string Error { get; set; }
}

public class TablesResponse
{
    public bool Success { get; set; }
    public List<string> Tables { get; set; }
}
```

---

### PHP

```php
<?php

class FirebirdApiClient
{
    private $apiUrl = 'http://85.114.224.45:8000';
    private $token = '–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨';

    // –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π SELECT –∑–∞–ø—Ä–æ—Å
    public function executeQuery($query, $params = [])
    {
        $data = [
            'query' => $query
        ];
        
        if (!empty($params)) {
            $data['params'] = $params;
        }

        $ch = curl_init($this->apiUrl . '/api/query');
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Authorization: Bearer ' . $this->token,
            'Content-Type: application/json'
        ]);

        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);

        if ($httpCode === 200) {
            $result = json_decode($response, true);
            if ($result['success']) {
                return $result['data'];
            } else {
                echo "–û—à–∏–±–∫–∞: " . $result['error'] . "\n";
                return null;
            }
        } else {
            echo "HTTP –æ—à–∏–±–∫–∞: $httpCode\n";
            return null;
        }
    }

    // –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ ID
    public function getById($table, $id)
    {
        $query = "SELECT * FROM $table WHERE ID = ?";
        $result = $this->executeQuery($query, [$id]);
        
        if ($result && count($result) > 0) {
            return $result[0];
        }
        return null;
    }

    // –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü
    public function getTables()
    {
        $ch = curl_init($this->apiUrl . '/api/tables');
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Authorization: Bearer ' . $this->token
        ]);

        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);

        if ($httpCode === 200) {
            $result = json_decode($response, true);
            return $result['tables'] ?? [];
        }
        return [];
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$client = new FirebirdApiClient();

// –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
$data = $client->executeQuery('SELECT FIRST 10 * FROM STORGRP ORDER BY NAME');
if ($data) {
    foreach ($data as $row) {
        print_r($row);
    }
}

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID
$item = $client->getById('STORGRP', 123);
if ($item) {
    print_r($item);
}

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
$tables = $client->getTables();
echo "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–∞–±–ª–∏—Ü: " . count($tables) . "\n";
?>
```

---

## ‚ö†Ô∏è –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö

### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:

- **200** - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- **400** - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, UPDATE/DELETE)
- **401** - –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω
- **404** - –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (–¥–ª—è `/api/schema/{table_name}`)
- **500** - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ (Python):

```python
import requests

def safe_query(query, token):
    try:
        response = requests.post(
            "http://85.114.224.45:8000/api/query",
            json={"query": query},
            headers={"Authorization": f"Bearer {token}"},
            timeout=30
        )
        
        if response.status_code == 200:
            data = response.json()
            if data["success"]:
                return {"success": True, "data": data["data"]}
            else:
                return {"success": False, "error": data["error"]}
        elif response.status_code == 401:
            return {"success": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞"}
        elif response.status_code == 400:
            return {"success": False, "error": "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å"}
        else:
            return {"success": False, "error": f"HTTP {response.status_code}"}
            
    except requests.exceptions.Timeout:
        return {"success": False, "error": "–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞"}
    except requests.exceptions.ConnectionError:
        return {"success": False, "error": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API"}
    except Exception as e:
        return {"success": False, "error": str(e)}
```

---

## üìù –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å SQL –∑–∞–ø—Ä–æ—Å–æ–≤

**‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```sql
-- –•–æ—Ä–æ—à–æ
SELECT * FROM TABLE WHERE ID = ?
-- params: [123]
```

**‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ (—Ä–∏—Å–∫ SQL –∏–Ω—ä–µ–∫—Ü–∏–π)
```sql
-- –ü–ª–æ—Ö–æ
SELECT * FROM TABLE WHERE ID = 123  -- –µ—Å–ª–∏ ID –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
```

### 2. –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ:**
- `SELECT` - –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `WITH ... SELECT` - CTE –∑–∞–ø—Ä–æ—Å—ã
- `SELECT ... FROM ... WHERE ... ORDER BY ...`
- –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã –≤ SELECT

**‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- `UPDATE` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `DELETE` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `INSERT` - –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `DROP` - —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
- `ALTER` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `CREATE` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (TTL: 10 –º–∏–Ω—É—Ç)
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
- –î–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `FIRST N` –∏–ª–∏ `LIMIT`

**–ü—Ä–∏–º–µ—Ä:**
```sql
-- –•–æ—Ä–æ—à–æ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏
SELECT FIRST 100 * FROM LARGE_TABLE

-- –ü–ª–æ—Ö–æ - –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ
SELECT * FROM LARGE_TABLE
```

### 4. –¢–∞–π–º–∞—É—Ç—ã

- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ç–∞–π–º–∞—É—Ç: 30 —Å–µ–∫—É–Ω–¥
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

---

## üîç –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞

```python
def get_sales_report(start_date, end_date):
    query = """
        SELECT 
            DATE,
            SUM(AMOUNT) as TOTAL_AMOUNT,
            COUNT(*) as ORDERS_COUNT
        FROM SALES
        WHERE DATE BETWEEN ? AND ?
        GROUP BY DATE
        ORDER BY DATE
    """
    
    result = execute_query(query, [start_date, end_date])
    return result
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É—Å–ª–æ–≤–∏—è–º

```python
def search_products(name_filter, min_price=None, max_price=None):
    query = "SELECT * FROM PRODUCTS WHERE NAME LIKE ?"
    params = [f"%{name_filter}%"]
    
    if min_price:
        query += " AND PRICE >= ?"
        params.append(min_price)
    
    if max_price:
        query += " AND PRICE <= ?"
        params.append(max_price)
    
    query += " ORDER BY NAME"
    
    return execute_query(query, params)
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
def get_order_with_items(order_id):
    query = """
        SELECT 
            o.ID,
            o.DATE,
            o.CUSTOMER_NAME,
            oi.PRODUCT_NAME,
            oi.QUANTITY,
            oi.PRICE
        FROM ORDERS o
        JOIN ORDER_ITEMS oi ON o.ID = oi.ORDER_ID
        WHERE o.ID = ?
        ORDER BY oi.PRODUCT_NAME
    """
    
    return execute_query(query, [order_id])
```

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

**–í–æ–ø—Ä–æ—Å—ã –ø–æ API:**
- Email: ivan.bondarenko.it@gmail.com
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/API.md`
- GitHub: https://github.com/IvanBondarenkoIT/firebird-db-proxy

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –¢–æ–∫–µ–Ω –≤—ã–¥–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

- [ ] –ü–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω health check endpoint
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 6 –Ω–æ—è–±—Ä—è 2025

