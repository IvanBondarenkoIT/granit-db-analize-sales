{% extends "base.html" %}

{% block title %}Таблица продаж{% endblock %}

{% block content %}
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title">Фильтры</h5>
      <form method="get" class="row gy-2 gx-3 align-items-end">
        <div class="col-sm-3">
          <label for="start_date" class="form-label">Дата с</label>
          <input type="date" class="form-control" id="start_date" name="start_date" value="{{ filters.start_date }}" />
        </div>
        <div class="col-sm-3">
          <label for="end_date" class="form-label">Дата по</label>
          <input type="date" class="form-control" id="end_date" name="end_date" value="{{ filters.end_date }}" />
        </div>
        <div class="col-sm-3">
          <label for="store" class="form-label">Магазин</label>
          <select class="form-select" id="store" name="store">
            <option value="">Все</option>
            {% for store in stores %}
              <option value="{{ store.id }}" {% if filters.store == store.id %}selected{% endif %}>{{ store.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-sm-2">
          <label for="sort" class="form-label">Сортировка</label>
          <select class="form-select" id="sort" name="sort">
            <option value="date" {% if filters.sort == 'date' %}selected{% endif %}>По дате</option>
            <option value="store" {% if filters.sort == 'store' %}selected{% endif %}>По магазину</option>
            <option value="sum" {% if filters.sort == 'sum' %}selected{% endif %}>По сумме</option>
          </select>
        </div>
        <div class="col-sm-1">
          <button type="submit" class="btn btn-primary w-100">OK</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Результаты</h5>
      {% if rows %}
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Магазин</th>
                <th>Дата</th>
                <th class="text-end">Чашки</th>
                <th class="text-end">Пачки (кг)</th>
                <th class="text-end">Сумма (₾)</th>
              </tr>
            </thead>
            <tbody>
              {% for row in rows %}
                <tr>
                  <td>{{ row.store_name }}</td>
                  <td>{{ row.order_date.strftime('%d.%m.%Y') }}</td>
                  <td class="text-end">{{ row.allcup | round(0) }}</td>
                  <td class="text-end">{{ row.packages_kg | round(2) }}</td>
                  <td class="text-end text-success">{{ row.total_cash | round(2) }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted">Нет данных для выбранных параметров.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
